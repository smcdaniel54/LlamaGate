name: orchestrator
version: 1.0.0
description: Coordinates workflows, manages execution, handles state, builds new AgenticModules, creates execution logs
type: workflow
enabled: true

inputs:
  - id: task
    type: object
    description: Task definition with workflow name, requirements, constraints
    required: true
  - id: state
    type: object
    description: Current workflow execution state
    required: false
  - id: context
    type: object
    description: Context from researcher and discriminator
    required: false

outputs:
  - id: workflow_design
    type: object
    description: Complete workflow design (agenticmodule.yaml structure)
  - id: execution_log
    type: string
    description: Execution log entry
  - id: state_snapshot
    type: object
    description: Current state snapshot
  - id: build_artifacts
    type: object
    description: Build artifacts (design documents, workflow structures)

steps:
  - name: coordinate_workflow_design
    uses: llm.chat
    with:
      model: mistral
      prompt: |
        You are an expert workflow orchestrator. Your role is to coordinate the design and 
        building of AgenticModules (high-value workflows) in LlamaGate.
        
        When given a task to build a workflow:
        1. Analyze the task requirements
        2. Design the workflow structure (agenticmodule.yaml)
        3. Plan the extension set needed
        4. Coordinate with researcher (for context) and discriminator (for quality checks)
        5. Create execution logs for all decisions
        6. Generate build artifacts (design documents, workflow structures)
        
        Always create comprehensive logs and artifacts for monitoring.
        
        Output format:
        {
          "workflow_design": {
            "name": "module-name",
            "version": "1.0.0",
            "description": "...",
            "inputs": [...],
            "outputs": [...],
            "workflow_steps": [...],
            "extensions": [...]
          },
          "execution_log": "timestamp: [decision/action]",
          "state_snapshot": {...},
          "build_artifacts": {
            "design_document": "...",
            "workflow_structure": {...}
          }
        }
        
        ---
        
        Coordinate workflow design for this task:
        
        Task: {{task}}
        Context: {{context}}
        Current State: {{state}}
        
        Design a complete AgenticModule workflow following LlamaGate patterns.
        Include all required extensions, workflow steps, inputs, outputs.
        Create logs and artifacts for monitoring.
    outputs:
      workflow_design: ${steps.coordinate_workflow_design.output.content}
      execution_log: ${steps.coordinate_workflow_design.output.execution_log}
      state_snapshot: ${steps.coordinate_workflow_design.output.state_snapshot}
      build_artifacts: ${steps.coordinate_workflow_design.output.build_artifacts}
